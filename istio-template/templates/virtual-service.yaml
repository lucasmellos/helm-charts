{{- if .Values.virtualservice.enabled }}
{{- with .Values.virtualservice.rules }}
{{- range . }}
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: {{ .name }}-vs
spec:
  hosts:
  {{- range .hosts }}
    - {{ . -}}
  {{ end }}
  gateways:
    - istio-system/{{ .gatewayName }}-gw
  {{ with .http }}
  http: {{-  toYaml . | nindent 3 }} 
  {{- end }}
  {{ with .tls }}   
  tcp: {{-  toYaml . | nindent 3 }} 
  {{- end }}
  {{ with .tcp }}   
  tls: {{-  toYaml . | nindent 3 }}
  {{- end }}
{{- end }}
{{- end }}
{{- end }}